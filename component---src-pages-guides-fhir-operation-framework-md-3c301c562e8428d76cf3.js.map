{"version":3,"sources":["webpack:///./src/pages/guides/FHIROperationFramework.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-guides-fhir-operation-framework-md-3c301c562e8428d76cf3.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/FHIR/FHIR/fhir/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1>{`IBM FHIR Server - Extended Operations Framework`}</h1>\n    <p>{`The HL7 FHIR Specification describes a `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/operations.html\"\n      }}>{`framework`}</a>{` of extended operations for the REST API.`}</p>\n    <p>{`This framework defines REST endpoints at the Base Server (System), scoped to specific resources (Type) and scoped to specific instances. `}</p>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`System`}</strong>{` - `}<a parentName=\"li\" {...{\n          \"href\": \"https://my-server.com/fhir-server/api/v4/$convert\"\n        }}>{`https://my-server.com/fhir-server/api/v4/$convert`}</a>{` - Convert from one format to another`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Type`}</strong>{` - `}<a parentName=\"li\" {...{\n          \"href\": \"https://my-server.com/fhir-server/api/v4/Patient/$export\"\n        }}>{`https://my-server.com/fhir-server/api/v4/Patient/$export`}</a>{` - Retrieve all the data from the Patient compartment`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Instance`}</strong>{` - `}<a parentName=\"li\" {...{\n          \"href\": \"https://my-server.com/fhir-server/api/v4/Patient/1-2-3-4/$export\"\n        }}>{`https://my-server.com/fhir-server/api/v4/Patient/1-2-3-4/$export`}</a>{` - Retrieve a specific Patient data from the Patient compartment data`}</li>\n    </ul>\n    <p>{`A list of operations supported by the IBM FHIR Server is listed at `}<a parentName=\"p\" {...{\n        \"href\": \"https://ibm.github.io/FHIR/Conformance/#extended-operations\"\n      }}>{`https://ibm.github.io/FHIR/Conformance/#extended-operations`}</a></p>\n    <h2>{`Calling an Operation`}</h2>\n    <p>{`There are two types of operation invocation requests: `}</p>\n    <ul>\n      <li parentName=\"ul\">{`Complex (via POST)`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`All operations can be invoked by passing a Parameters resource instance in the body of the request.`}</li>\n          <li parentName=\"ul\">{`For operations with no input parameters, no body is required.`}</li>\n          <li parentName=\"ul\">{`For operations with a single input parameter named “resource”, the Parameters wrapper can be omitted.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`Simple (via GET)`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Only simple input parameters (i.e. no complex datatypes like ‘Identifier’ or ‘Reference’), operations can be invoked via HTTP GET by passing the parameters in the URL.`}</li>\n        </ul>\n      </li>\n    </ul>\n    <h3>{`Example: Complex`}</h3>\n    <p><em parentName=\"p\">{`Request`}</em></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sh\"\n      }}>{`curl --location --request POST 'https://localhost:9443/fhir-server/api/v4/Patient/$validate' \\\\\n--header 'Authorization: Basic CHANGEME' \\\\\n--header 'Content-Type: application/json' \\\\\n--data-raw '{\n \"resourceType\": \"Parameters\",\n \"parameter\": [\n  {\n   \"name\": \"resource\",\n   \"resource\": {\n    \"resourceType\": \"Patient\",\n    \"id\": \"example\",\n    \"name\": [\n     {\n      \"use\": \"official\",\n      \"family\": \"Chalmers\",\n      \"given\": [\n       \"Peter\",\n       \"James\"\n      ]\n     }\n    ]\n   }\n  }\n ],\n \"meta\": {\n  \"tag\": [\n   {\n    \"system\": \"http://terminology.hl7.org/CodeSystem/v3-ActReason\",\n    \"code\": \"HTEST\",\n    \"display\": \"test health data\"\n   }\n  ]\n }\n}'\n`}</code></pre>\n    <p><em parentName=\"p\">{`Response`}</em></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n  \"resourceType\": \"OperationOutcome\",\n  \"id\": \"NoError\",\n  \"text\": {\n    \"status\": \"additional\",\n    \"div\": \"<div xmlns=\\\\\"http://www.w3.org/1999/xhtml\\\\\"><p>No error</p></div>\"\n  },\n  \"issue\": [\n    {\n      \"severity\": \"warning\",\n      \"code\": \"invariant\",\n      \"details\": {\n        \"text\": \"dom-6: A resource should have narrative for robust management\"\n      },\n      \"expression\": [\n        \"Patient\"\n      ]\n    }\n  ]\n}\n`}</code></pre>\n    <h3>{`Example: Simple`}</h3>\n    <p><em parentName=\"p\">{`Request`}</em></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sh\"\n      }}>{`curl --location --request GET 'https://localhost:9443/fhir-server/api/v4/$healthcheck' \\\\\n--header 'Authorization: Basic CHANGEME' \\\\\n--header 'Content-Type: application/json'\n`}</code></pre>\n    <p><em parentName=\"p\">{`Response`}</em>{` `}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-json\"\n      }}>{`{\n  \"resourceType\": \"OperationOutcome\",\n  \"issue\": [\n    {\n      \"severity\": \"information\",\n      \"code\": \"informational\",\n      \"details\": {\n        \"text\": \"All OK\"\n      }\n    }\n  ]\n}\n`}</code></pre>\n    <h2>{`Inspecting a FHIR Server’s Capability Statement (Operations)`}</h2>\n    <p>{`Each FHIR server is expected to have a Capability Statement outlining the System, Type and Instance operations, and advertising them via the metadata endpoint. `}</p>\n    <p>{`To check the Type and Instance operations, you can check using this curl/jq command. `}</p>\n    <p><inlineCode parentName=\"p\">{`curl -k --location --request GET 'https://localhost:9443/fhir-server/api/v4/metadata' | jq -r '.rest[].resource[].operation[].name' | sort -u`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{}}>{`apply\nclosure\nconvert\ndocument\nexpand\nexport\nlookup\nsubsumes\ntranslate\nvalidate\nvalidate-code\n`}</code></pre>\n    <p>{`To check the System Level operations, you can check using this curl/jq command. `}</p>\n    <p><inlineCode parentName=\"p\">{`curl -k --location --request GET 'https://localhost:9443/fhir-server/api/v4/metadata' | jq -r '.rest[].operation[].name'`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{}}>{`bulkdata-status\nclosure\nconvert\nexport\nhealthcheck\nhello\nimport\n`}</code></pre>\n    <h1>{`The Specification in More Detail`}</h1>\n    <p>{`Each Operation per `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/operations.html#defining\"\n      }}>{`the specification`}</a>{` is an `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/operationdefinition.html\"\n      }}>{`OperationDefinition`}</a>{` Resource.`}</p>\n    <p>{`The elements needed are: `}</p>\n    <ul>\n      <li parentName=\"ul\">{`Unique Name of the Operation - `}<inlineCode parentName=\"li\">{`OperationDefinition.name`}</inlineCode>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`For instance, `}<inlineCode parentName=\"li\">{`\"name\": \"import\"`}</inlineCode></li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`Code used to activate the Operation - `}<inlineCode parentName=\"li\">{`OperationDefinition.code`}</inlineCode>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`For instance, `}<inlineCode parentName=\"li\">{`\"code\": \"import\"`}</inlineCode></li>\n          <li parentName=\"ul\">{`The `}<em parentName=\"li\">{`code`}</em>{` is used in the CapabilityStatement.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`The Context - System, Type, Instance - `}<inlineCode parentName=\"li\">{`OperationDefinition.system`}</inlineCode>{`, `}<inlineCode parentName=\"li\">{`Operation.type`}</inlineCode>{`, `}<inlineCode parentName=\"li\">{`Operation.instance`}</inlineCode>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`For instance, `}<inlineCode parentName=\"li\">{`\"system\": true`}</inlineCode></li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`Kind - always an `}<inlineCode parentName=\"li\">{`operation`}</inlineCode>{` - `}<inlineCode parentName=\"li\">{`OperationDefinition.kind`}</inlineCode></li>\n      <li parentName=\"ul\">{`Status - `}<inlineCode parentName=\"li\">{`OperationDefinition.status`}</inlineCode>{`, for implementers that are not intending to manage the lifecycle, best to put `}<inlineCode parentName=\"li\">{`draft`}</inlineCode></li>\n      <li parentName=\"ul\">{`Parameter - The list of parameters for the Operation - `}<inlineCode parentName=\"li\">{`OperationDefinition.parameter`}</inlineCode>{` - `}<a parentName=\"li\" {...{\n          \"href\": \"https://www.hl7.org/fhir/r4/operationdefinition-definitions.html#OperationDefinition.parameter\"\n        }}>{`Link`}</a>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Specificy your Query Parameter`}</li>\n          <li parentName=\"ul\">{`Be sure to have a return parameter`}</li>\n          <li parentName=\"ul\">{`Typically this is a FHIR Resource`}</li>\n        </ul>\n      </li>\n    </ul>\n    <p>{`An example operation is `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/resource-operation-validate.html\"\n      }}>{`$validate`}</a>{`. The OperationDefinition is at `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/FHIR/blob/main/operation/fhir-operation-validate/src/main/resources/validate.json\"\n      }}>{`validation.json`}</a>{`.`}</p>\n    <h1>{`IBM FHIR Server Extended Operations Framework`}</h1>\n    <p>{`The IBM FHIR Server has integrated the Extended Operations Framework into the code base. `}</p>\n    <img {...{\n      \"src\": \"https://raw.githubusercontent.com/wiki/IBM/FHIR/operation/operation-framework.png\",\n      \"alt\": \"Framework\"\n    }}></img>\n    <p>{`Upon startup of the IBM FHIR Server webapplication, the FHIR Operation Registry uses the Java ServiceLoader framework. Each Operation is registered with the FHIROperationRegistry using `}<inlineCode parentName=\"p\">{`META-INF/services/com.ibm.fhir.server.operation.spi.FHIROperation`}</inlineCode>{` which lists each of the classes that extends the `}<inlineCode parentName=\"p\">{`AbstractOperation`}</inlineCode>{`.`}</p>\n    <p>{`Upon receiving a request, the REST Layer checks to see if the JAX-RS path parameter `}<inlineCode parentName=\"p\">{`\\${operationName}`}</inlineCode>{` from a System, Type or Instance call is a registered Operation. If the operationName exists and is valid, the framework invokes the specific Operation for that specific Operation type.`}</p>\n    <p>{`The Operation’s custom logic is executed using the specific Operation logic, and the Persistence Helper is used to access the helper methods to start and end the transaction. `}</p>\n    <p>{`The Operation’s custom logic builds a valid Parameters resource as a response to the client, and the framework serializes back to the client.`}</p>\n    <p>{`Note, once the Operation is loaded it is available until the server is restarted and redoes the ServiceLoader discovery.`}</p>\n    <h2>{`Code Examples`}</h2>\n    <p>{`There are a number of examples in the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/FHIR/tree/main/operation\"\n      }}>{`IBM/FHIR repo`}</a>{`.`}</p>\n    <h2>{`Installation of an Operation`}</h2>\n    <p>{`The Operations are installed into the `}<inlineCode parentName=\"p\">{`userlib`}</inlineCode>{` folder of the IBM FHIR Server. Some solutions are installing the operation as a layer in a docker image, or mount it as a volume.`}</p>\n    <img {...{\n      \"src\": \"https://raw.githubusercontent.com/wiki/IBM/FHIR/operation/installation-location.png\",\n      \"alt\": \"install location\"\n    }}></img>\n    <h2>{`Building a FHIR Operation`}</h2>\n    <p>{`To build a FHIR Operation, a great starting point is the GitHub repo.`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Create a Maven Java project. Prefix the artifactid with `}<inlineCode parentName=\"li\">{`fhir-operation-`}</inlineCode>{` and give it a useful name, such as fhir-operation-myop.`}</li>\n      <li parentName=\"ol\">{`Add the relevant dependencies, such as `}<inlineCode parentName=\"li\">{`fhir-server`}</inlineCode>{`.\nThe pom.xml should look like: `}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{`<project xmlns=\"http://maven.apache.org/POM/4.0.0\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n\n    <artifactId>fhir-operation-myop</artifactId>\n\n    <parent>\n        <groupId>com.ibm.fhir</groupId>\n        <artifactId>fhir-parent</artifactId>\n        <version>4.4.1-SNAPSHOT</version>\n        <relativePath>../../fhir-parent</relativePath>\n    </parent>\n\n    <dependencies>\n        <dependency>\n  <groupId>\\${project.groupId}</groupId>\n  <artifactId>fhir-server</artifactId>\n  <version>\\${project.version}</version>\n        </dependency>\n    </dependencies>\n\n</project>\n`}</code></pre>\n    <p>{`Note, if you are using the persistence layer, you naturally get the fhir-persistence libraries as a dependency.\nNote, if you are including some custom libraries or other libraries, you should shade the dependencies into a single jar or deliverable. `}</p>\n    <ol {...{\n      \"start\": 3\n    }}>\n      <li parentName=\"ol\">{`Add your OperationDefinition to the `}<inlineCode parentName=\"li\">{`src/main/resources`}</inlineCode>{`, such as healthcare.json. `}</li>\n      <li parentName=\"ol\">{`Extend the AbstractOperation in your package, such as, `}<inlineCode parentName=\"li\">{`com.ibm.fhir.demo.MyOperation`}</inlineCode></li>\n      <li parentName=\"ol\">{`Create the Services Loader file `}<inlineCode parentName=\"li\">{`com.ibm.fhir.server.operation.spi.FHIROperation`}</inlineCode>{` in `}<inlineCode parentName=\"li\">{`src/main/resources/META-INF/services/`}</inlineCode></li>\n      <li parentName=\"ol\">{`Put a single line in the package for each of the Operations that are going to be hosted in the package.`}\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`com.ibm.fhir.demo.MyOperation\ncom.ibm.fhir.demo.DemoOperation\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">{`Add the constructor, such as: `}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`    public HealthcheckOperation() {\n        super();\n    }\n`}</code></pre>\n    <ol {...{\n      \"start\": 8\n    }}>\n      <li parentName=\"ol\">{`In the class extending the AbstractOperation, override the `}<inlineCode parentName=\"li\">{`buildOperationDefinition()`}</inlineCode>{` to load the OperationDefinition (note you could use the OperationDefinition.Builder to generate the configuration).`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`    protected OperationDefinition buildOperationDefinition() {\n        try (InputStream in = getClass().getClassLoader().getResourceAsStream(\"healthcheck.json\")) {\n  return FHIRParser.parser(Format.JSON).parse(in);\n        } catch (Exception e) {\n  throw new Error(e);\n        }\n    }\n`}</code></pre>\n    <ol {...{\n      \"start\": 9\n    }}>\n      <li parentName=\"ol\">{`Override the `}<inlineCode parentName=\"li\">{`doInvoke`}</inlineCode>{`. `}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`@Override\n    protected Parameters doInvoke(FHIROperationContext operationContext, Class<? extends Resource> resourceType, String logicalId, String versionId, Parameters parameters, FHIRResourceHelpers resourceHelper) throws FHIROperationException {\n        // Do Business Logic\n    }\n`}</code></pre>\n    <ol {...{\n      \"start\": 10\n    }}>\n      <li parentName=\"ol\">{`Implement your business logic using the invoke Parameters. Every request is secured by a user-group and has an associated tenant/user.`}</li>\n    </ol>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Method Parameter`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`How to use it`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`FHIROperationContext operationContext`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`If you need access to the URI, HTTP Headers, Request Properties, GET or POST (and subsequent) setting of a response status or body, these are used for decision making`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`Class<? extends Resource> resourceType`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`If an instance or type call, this is non-null, and used to help the business logic make switches between different code paths`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`String logicalId`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`If an instance call, this is non-null, and used to help the business logic make switches between different code paths`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`String versionId`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`If an instance call, this is non-null, and used to help the business logic make switches between different code paths`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`Parameters parameters`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`The input parameters used to trigger specific elements of the code path and used to help select outcomes`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`FHIRResourceHelpers resourceHelper`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Helper method to call Search using the REST interface (which is the easiest)`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <ol {...{\n      \"start\": 11\n    }}>\n      <li parentName=\"ol\">{`Return your response`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`return FHIROperationUtil.getOutputParameters(operationOutcome);\n`}</code></pre>\n    <p>{`If you return a single Resource in the Parameters object, the result is the single resource, such as a single OperationOutcome returned without the response Parameters.`}</p>\n    <h1>{`Tips and Tricks`}</h1>\n    <p>{`The following are some tips and tricks:`}</p>\n    <h2>{`Length of Interaction`}</h2>\n    <p>{`The framework is best suited for non-long poll requests such that an operation.`}</p>\n    <p>{`If you need to dispatch an operation, use two operations - one request operation, and one status/response operation. `}</p>\n    <h2>{`Transactions`}</h2>\n    <p>{`If you need to access the underlying persistence layer, you should request a transaction, and rollback or end it using on the FHIRPersistenceTransaction. `}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`  FHIRPersistence pl =\n(FHIRPersistence) operationContext.getProperty(FHIROperationContext.PROPNAME_PERSISTENCE_IMPL);\n\n  FHIRPersistenceTransaction tx = resourceHelper.getTransaction();\n  tx.begin();\n  \n  try {\n      // Do Operation\n      return FHIROperationUtil.getOutputParameters(operationOutcome);\n  } catch (Throwable t) {\n      tx.setRollbackOnly();\n      throw t;\n  } finally {\n      tx.end();\n  }\n`}</code></pre>\n    <p>{`Naturally you’ll have access to any persistence operation which includes the RESTful actions - create, read, _vread, search, et cetra.`}</p>\n    <h2>{`Multitenancy`}</h2>\n    <p>{`By default, all tenants have access to an operation. Each Operation, if it has a multi-tenant requirement, must uses the FHIRRequestContext to get access to the Tenant Id and make a decision based on the id.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`  FHIRRequestContext ctx = FHIRRequestContext.get();\n  String tenantId = ctx.getTenantId();\n`}</code></pre>\n    <h2>{`Mutating the Response Code and Non-FHIR Resource Type responses`}</h2>\n    <p>{`To break out of the default response, use the `}<inlineCode parentName=\"p\">{`FHIROperationContext`}</inlineCode>{` which is ThreadSafe to mutate the Response. `}</p>\n    <p><em parentName=\"p\">{`Mutated Status`}</em></p>\n    <p><inlineCode parentName=\"p\">{`operationContext.setProperty(FHIROperationContext.PROPNAME_STATUS_TYPE, Response.Status.ACCEPTED);`}</inlineCode></p>\n    <p><em parentName=\"p\">{`Mutated Response`}</em>{` - Non-FHIR`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-java\"\n      }}>{`Response response = Response.status(Status.OK).entity(PollingLocationResponse.Writer.generate(pollingResponse)).type(MediaType.APPLICATION_JSON).build();\noperationContext.setProperty(FHIROperationContext.PROPNAME_RESPONSE, response);\n`}</code></pre>\n    <p>{`You can return null as a Parameters object - `}<inlineCode parentName=\"p\">{`return FHIROperationUtil.getOutputParameters(null);`}</inlineCode></p>\n    <h1>{`Questions and Support`}</h1>\n    <p>{`If you need further support, you can reach out to the development team at: `}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://chat.fhir.org/#narrow/stream/212434-ibm\"\n        }}>{`Zulip: ibm`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/IBM/FHIR/issues\"\n        }}>{`GitHub: issues`}</a></li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}