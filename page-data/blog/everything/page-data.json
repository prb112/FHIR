{"componentChunkName":"component---src-pages-blog-everything-md","path":"/blog/everything/","result":{"pageContext":{"frontmatter":{"layout":"post","title":"Introducing the IBM FHIR Server - $everything operation","description":"Introducing the IBM FHIR Server - $everything operation","date":"2021-04-21T00:00:00.000Z"},"relativePagePath":"/blog/everything.md","titleType":"append","MdxNode":{"id":"0626ee2f-6bf3-53b5-b4b6-7ee25acb5fcd","children":[],"parent":"10b07c35-232f-5947-bb03-4c9b6883f943","internal":{"content":"---\nlayout: post\ntitle:  Introducing the IBM FHIR Server - $everything operation\ndescription: Introducing the IBM FHIR Server - $everything operation \ndate:   2021-04-21\n---\n\n# Introducing the IBM FHIR Server - $everything operation\nIn [IBM FHIR Server 4.7.0](https://github.com/IBM/FHIR/releases/tag/4.7.0), the IBM FHIR Server team turned on the `Patient/$everything` operation. We have this feature thanks to external contributor and an IBMer, [Luis García](https://github.com/luisgarcc) who implemented  the operation [#1044](https://github.com/IBM/FHIR/issues/1044). \n\nSo what do you get with `Patient/$everything`? Well, following the HL7 FHIR R4 [specification](http://hl7.org/fhir/patient-operation-everything.html), you get an operation that returns a \"searchset\" bundle with the information related to a patient in the context it is invoked. In the IBM FHIR Server's case, the server returns whatever resources are related to the Patient - e.g. practitioners, medications, locations, organizations etc.  You also get support for `Patient/[id]/$everything` where the `[ID]` is the logical id specific to a patient.\n\nLet's build a request and see it in action:\n\nWe need to know about the parameters of the `$everything` operation. \n\n| Name | Type | Description |\n|---|---|---|\n| `start` | date | The date range relates to care dates, not record currency dates - e.g. all records relating to care provided in a certain date range. If no start date is provided, all records prior to the end date are in scope. |\n| `end` | date | The date range relates to care dates, not record currency dates - e.g. all records relating to care provided in a certain date range. If no end date is provided, all records subsequent to the start date are in scope. |\n| `_since` | date | Resources updated after this period will be included in the response. The intent of this parameter is to allow a client to request only records that have changed since the last request, based on either the return header time, or or (for asynchronous use), the transaction time|\n| `_type` | code | One or more parameters, each containing one or more comma-delimited FHIR resource types to include in the return resources. In the absence of any specified types, the server returns all resource types | \n| `return` | Bundle | The bundle is \"searchset\" |\n\nNote, currently the implementation ignores the `_count` parameter.\n\nNow, let's prepopulate some sample data on the server using the [Integration Test data](https://github.com/IBM/FHIR/blob/main/fhir-server-test/src/test/resources/testdata/everything-operation/Antonia30_Acosta403.json).\n\n1. Download the Sample Data\n\n``` sh\ncurl -L https://raw.githubusercontent.com/IBM/FHIR/main/fhir-server-test/src/test/resources/testdata/everything-operation/Antonia30_Acosta403.json -o Antonia30_Acosta403.json\n```\n\n2. Load the Sample Data bundle to the IBM FHIR Server\n\n``` sh\ncurl -k --location --request POST 'https://localhost:9443/fhir-server/api/v4' \\\n    --header 'Content-Type: application/fhir+json' \\\n    --user \"fhiruser:${DUMMY_PASSWORD}\" \\\n    --data-binary  \"@Antonia30_Acosta403.json\" -o response.json\n```\n\n3. Scan the response.json for any status that is not `\"status\": \"201\"`.  For example, the status is in the family of User Request Error or Server Side Error.\n\n4. Check the `response.json` and find the id for Patient (it should be the first one).\n\n``` json\n        {\n            \"response\": {\n                \"id\": \"178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n                \"status\": \"201\",\n                \"location\": \"Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/_history/1\",\n                \"etag\": \"W/\\\"1\\\"\",\n                \"lastModified\": \"2021-04-21T13:34:50.207684Z\"\n            }\n        },\n```\n\n5. Check the `Patient/[id]/$everything`\n\n* Request *\n``` sh\ncurl -k --location --request GET 'https://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/$everything' \\\n    --header 'Content-Type: application/fhir+json' \\\n    --user \"fhiruser:${DUMMY_PASSWORD}\" \\\n```\n\n* Response *\n\n``` json\n{\n    \"resourceType\": \"Bundle\",\n    \"id\": \"689856f9-6ef6-4d74-8f77-a813ff7b1c6d\",\n    \"type\": \"searchset\",\n    \"total\": 895,\n    \"entry\": [\n        {\n            \"fullUrl\": \"https://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n            \"resource\": {\n                \"resourceType\": \"Patient\",\n                \"id\": \"178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n                \"meta\": {\n                    \"versionId\": \"1\",\n                    \"lastUpdated\": \"2021-04-21T13:34:50.207684Z\"\n                }\n                ...\n            }\n        }\n    ]\n}\n```\n\n6. Check the `Patient/[id]/$everything` with a _type constraint and _since.\n\n* Request *\n\n``` sh\ncurl -k --location --request GET 'https://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/$everything?_type=CarePlan,CareTeam&_since=2021-01-01T00:00:00Z&_count=1' \\\n    --header 'Content-Type: application/fhir+json' \\\n    --user \"fhiruser:${DUMMY_PASSWORD}\" -o care.json\n```\n\n* Response *\n\n``` json\n{\n    \"resourceType\": \"Bundle\",\n    \"id\": \"689856f9-6ef6-4d74-8f77-a813ff7b1c6d\",\n    \"type\": \"searchset\",\n    \"total\": 11,\n    \"entry\": [\n        {\n            \"fullUrl\": \"https://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n            \"resource\": {\n                \"resourceType\": \"Patient\",\n                \"id\": \"178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n                \"meta\": {\n                    \"versionId\": \"1\",\n                    \"lastUpdated\": \"2021-04-21T13:34:50.207684Z\"\n                }\n                ...\n            }\n        }\n    ]\n}\n```\n\nYou'll see further down CareTeam and CarePlan resources... \n\n7. This is where we can have a bit of fun...  download the [fhir-path-cli](https://github.com/IBM/FHIR/releases/download/4.7.0/fhir-path-4.7.0-cli.jar)\n\n``` sh \ncurl -L https://github.com/IBM/FHIR/releases/download/4.7.0/fhir-path-4.7.0-cli.jar -o fhir-path-4.7.0-cli.jar\n```\n\n8. Let's run the fhir-path-4.7.0-cli.jar and test a FHIRPath. \n\n*Command Line*\n\n```\njava -jar fhir-path-4.7.0-cli.jar --path 'entry.fullUrl' --file care.json \n```\n\n*Output* \n\n```\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f86a-1a9a1d73-4d1d-46d5-8494-339dddbfe9d2\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f86b-06c07a6c-3be7-4e6a-abb2-040ff67c8c1f\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f873-d8069835-938e-45b1-9a70-5aba3794f6f3\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f87c-ce204596-8037-416c-b2e0-fc7442d9a276\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f87c-46785bc7-807a-40e0-bc08-792977ac8ec8\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f86a-b79251c3-5019-426e-8211-748adbdfdf54\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f86b-22a7baab-77b3-4fb5-b318-9249ea80ec85\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f873-e370fba2-f45e-4cdd-b13b-781e249f84f8\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f87c-596d80cc-7b42-4054-bc02-a48acfcc95b7\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f87c-6cc197cd-b665-46e0-ad35-c016edeaf13b\n```\n\nYou've seen a brief introduction to fhir-operation-everything and a bonus fhir-path-cli showing the output.\n\nNote, `DUMMY_PASSWORD` should be replaced with or set as a value when the corresponding curl steps are executed.\n","type":"Mdx","contentDigest":"3368afccac7b803e9cd81bdaf5328137","counter":105,"owner":"gatsby-plugin-mdx","fieldOwners":{"slug":"gatsby-plugin-slug"}},"frontmatter":{"title":"Introducing the IBM FHIR Server - $everything operation","layout":"post","description":"Introducing the IBM FHIR Server - $everything operation","date":"2021-04-21T00:00:00.000Z"},"exports":{},"rawBody":"---\nlayout: post\ntitle:  Introducing the IBM FHIR Server - $everything operation\ndescription: Introducing the IBM FHIR Server - $everything operation \ndate:   2021-04-21\n---\n\n# Introducing the IBM FHIR Server - $everything operation\nIn [IBM FHIR Server 4.7.0](https://github.com/IBM/FHIR/releases/tag/4.7.0), the IBM FHIR Server team turned on the `Patient/$everything` operation. We have this feature thanks to external contributor and an IBMer, [Luis García](https://github.com/luisgarcc) who implemented  the operation [#1044](https://github.com/IBM/FHIR/issues/1044). \n\nSo what do you get with `Patient/$everything`? Well, following the HL7 FHIR R4 [specification](http://hl7.org/fhir/patient-operation-everything.html), you get an operation that returns a \"searchset\" bundle with the information related to a patient in the context it is invoked. In the IBM FHIR Server's case, the server returns whatever resources are related to the Patient - e.g. practitioners, medications, locations, organizations etc.  You also get support for `Patient/[id]/$everything` where the `[ID]` is the logical id specific to a patient.\n\nLet's build a request and see it in action:\n\nWe need to know about the parameters of the `$everything` operation. \n\n| Name | Type | Description |\n|---|---|---|\n| `start` | date | The date range relates to care dates, not record currency dates - e.g. all records relating to care provided in a certain date range. If no start date is provided, all records prior to the end date are in scope. |\n| `end` | date | The date range relates to care dates, not record currency dates - e.g. all records relating to care provided in a certain date range. If no end date is provided, all records subsequent to the start date are in scope. |\n| `_since` | date | Resources updated after this period will be included in the response. The intent of this parameter is to allow a client to request only records that have changed since the last request, based on either the return header time, or or (for asynchronous use), the transaction time|\n| `_type` | code | One or more parameters, each containing one or more comma-delimited FHIR resource types to include in the return resources. In the absence of any specified types, the server returns all resource types | \n| `return` | Bundle | The bundle is \"searchset\" |\n\nNote, currently the implementation ignores the `_count` parameter.\n\nNow, let's prepopulate some sample data on the server using the [Integration Test data](https://github.com/IBM/FHIR/blob/main/fhir-server-test/src/test/resources/testdata/everything-operation/Antonia30_Acosta403.json).\n\n1. Download the Sample Data\n\n``` sh\ncurl -L https://raw.githubusercontent.com/IBM/FHIR/main/fhir-server-test/src/test/resources/testdata/everything-operation/Antonia30_Acosta403.json -o Antonia30_Acosta403.json\n```\n\n2. Load the Sample Data bundle to the IBM FHIR Server\n\n``` sh\ncurl -k --location --request POST 'https://localhost:9443/fhir-server/api/v4' \\\n    --header 'Content-Type: application/fhir+json' \\\n    --user \"fhiruser:${DUMMY_PASSWORD}\" \\\n    --data-binary  \"@Antonia30_Acosta403.json\" -o response.json\n```\n\n3. Scan the response.json for any status that is not `\"status\": \"201\"`.  For example, the status is in the family of User Request Error or Server Side Error.\n\n4. Check the `response.json` and find the id for Patient (it should be the first one).\n\n``` json\n        {\n            \"response\": {\n                \"id\": \"178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n                \"status\": \"201\",\n                \"location\": \"Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/_history/1\",\n                \"etag\": \"W/\\\"1\\\"\",\n                \"lastModified\": \"2021-04-21T13:34:50.207684Z\"\n            }\n        },\n```\n\n5. Check the `Patient/[id]/$everything`\n\n* Request *\n``` sh\ncurl -k --location --request GET 'https://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/$everything' \\\n    --header 'Content-Type: application/fhir+json' \\\n    --user \"fhiruser:${DUMMY_PASSWORD}\" \\\n```\n\n* Response *\n\n``` json\n{\n    \"resourceType\": \"Bundle\",\n    \"id\": \"689856f9-6ef6-4d74-8f77-a813ff7b1c6d\",\n    \"type\": \"searchset\",\n    \"total\": 895,\n    \"entry\": [\n        {\n            \"fullUrl\": \"https://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n            \"resource\": {\n                \"resourceType\": \"Patient\",\n                \"id\": \"178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n                \"meta\": {\n                    \"versionId\": \"1\",\n                    \"lastUpdated\": \"2021-04-21T13:34:50.207684Z\"\n                }\n                ...\n            }\n        }\n    ]\n}\n```\n\n6. Check the `Patient/[id]/$everything` with a _type constraint and _since.\n\n* Request *\n\n``` sh\ncurl -k --location --request GET 'https://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/$everything?_type=CarePlan,CareTeam&_since=2021-01-01T00:00:00Z&_count=1' \\\n    --header 'Content-Type: application/fhir+json' \\\n    --user \"fhiruser:${DUMMY_PASSWORD}\" -o care.json\n```\n\n* Response *\n\n``` json\n{\n    \"resourceType\": \"Bundle\",\n    \"id\": \"689856f9-6ef6-4d74-8f77-a813ff7b1c6d\",\n    \"type\": \"searchset\",\n    \"total\": 11,\n    \"entry\": [\n        {\n            \"fullUrl\": \"https://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n            \"resource\": {\n                \"resourceType\": \"Patient\",\n                \"id\": \"178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\",\n                \"meta\": {\n                    \"versionId\": \"1\",\n                    \"lastUpdated\": \"2021-04-21T13:34:50.207684Z\"\n                }\n                ...\n            }\n        }\n    ]\n}\n```\n\nYou'll see further down CareTeam and CarePlan resources... \n\n7. This is where we can have a bit of fun...  download the [fhir-path-cli](https://github.com/IBM/FHIR/releases/download/4.7.0/fhir-path-4.7.0-cli.jar)\n\n``` sh \ncurl -L https://github.com/IBM/FHIR/releases/download/4.7.0/fhir-path-4.7.0-cli.jar -o fhir-path-4.7.0-cli.jar\n```\n\n8. Let's run the fhir-path-4.7.0-cli.jar and test a FHIRPath. \n\n*Command Line*\n\n```\njava -jar fhir-path-4.7.0-cli.jar --path 'entry.fullUrl' --file care.json \n```\n\n*Output* \n\n```\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f86a-1a9a1d73-4d1d-46d5-8494-339dddbfe9d2\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f86b-06c07a6c-3be7-4e6a-abb2-040ff67c8c1f\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f873-d8069835-938e-45b1-9a70-5aba3794f6f3\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f87c-ce204596-8037-416c-b2e0-fc7442d9a276\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CarePlan/178f4a3f87c-46785bc7-807a-40e0-bc08-792977ac8ec8\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f86a-b79251c3-5019-426e-8211-748adbdfdf54\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f86b-22a7baab-77b3-4fb5-b318-9249ea80ec85\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f873-e370fba2-f45e-4cdd-b13b-781e249f84f8\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f87c-596d80cc-7b42-4054-bc02-a48acfcc95b7\nhttps://localhost:9443/fhir-server/api/v4/Patient/178f4a3f869-6abfe1e6-3a4a-4c9a-81a8-fb8c6263e003/CareTeam/178f4a3f87c-6cc197cd-b665-46e0-ad35-c016edeaf13b\n```\n\nYou've seen a brief introduction to fhir-operation-everything and a bonus fhir-path-cli showing the output.\n\nNote, `DUMMY_PASSWORD` should be replaced with or set as a value when the corresponding curl steps are executed.\n","fileAbsolutePath":"/home/runner/work/FHIR/FHIR/fhir/docs/src/pages/blog/everything.md","fields":{"slug":"/blog/everything"}}}},"staticQueryHashes":["1364590287","2102389209","2102389209","227138135","227138135","2456312558","2746626797","2746626797","3018647132","3018647132","3906363820","3906363820","768070550"]}