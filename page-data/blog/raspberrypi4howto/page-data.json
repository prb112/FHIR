{"componentChunkName":"component---src-pages-blog-raspberrypi-4-howto-mdx","path":"/blog/raspberrypi4howto/","result":{"pageContext":{"frontmatter":{"layout":"post","title":"IBM FHIR Server on the Raspberry Pi 4","description":"IBM FHIR Server on the Raspberry Pi 4","date":"2019-10-08 09:59:05 -0400"},"relativePagePath":"/blog/raspberrypi4howto.mdx","titleType":"append","MdxNode":{"id":"4e9824ad-26bd-515d-ae56-4f6a3d8e10d6","children":[],"parent":"44e79b1f-0c08-5409-b535-5e657da460c1","internal":{"content":"---\nlayout: post\ntitle:  IBM FHIR Server on the Raspberry Pi 4\ndescription: IBM FHIR Server on the Raspberry Pi 4\ndate:   2019-10-08 09:59:05 -0400\n---\n\n![IBM FHIR Server on Raspberry Pi 4](https://ibm.github.io/FHIR/images/piOnFhir30.jpg)\n\n## Usage\n\nThis installation is for curiosity only and should not be used with PHI, only synthetic test data. Production instances require additional hardening which is outside the scope of this guide. \n\nThe default password used throughout is `change-password` and this is configured as clear-text in the configuration files to make it even more obvious that it should be changed as part of any hardening. Refer to the [FHIRServerUsersGuide](https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide) for more details.\n\n## Introduction\n\nThe IBM FHIR Server runs as a web application in the Open Liberty application server. By default persistence is provided with a Derby database, but it can also be configured to use IBM Db2 on Cloud. This example shall use the default Derby instance.\n\n| Component    | Details        |\n| ------------ | -------------- |\n| Hardware     | Raspberry Pi 4 |\n| Memory       | 4GB            |\n| OS           | Raspbian (Buster) |\n| Storage      | 64GB microSD   |\n| Java         | openjdk11      |\n| Apache Maven | 3.6.1          |\n| Application Server | Open Liberty 19.0.0.8 |\n| HTTPS Port | 9443 |\n| Default user | fhiruser |\n| Default password | change-password |\n\nSet up your Raspberry Pi 4 (4GB model) using Raspbian (https://www.raspberrypi.org/downloads/).\n\n> TIP: Under load, the Raspberry Pi 4 CPU throttles when it reaches a critical temperature, so a case with cooling is recommended. Without naming products, an aluminum case which acts as a heat sink could be a good choice. The CPU definitely throttles during the build using the official (plastic) Raspberry Pi 4 case.\n\n## Development Environment and Prerequisites\n\nTo build we need three things:\n  1. openjdk11 (already available)\n  2. Apache Maven\n  3. Access to the internet (for Maven dependencies)\n\n### Install Maven\n\nYou can use apt-get to install Apache Maven but if you want to avoid all the dependencies which come along with it, just grab the binary release and unpack it\n\nOPTION A:\n\n```\nsudo apt-get install maven\n```\n\nOPTION B:\n\n```\nwget https://www-us.apache.org/dist/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz -P /tmp\nsudo mkdir -p /opt/tools && cd /opt/tools && tar xzvf /tmp/apache-maven-3.6.1-bin.tar.gz\n\n```\n\nIf installing Maven manually, add it to your PATH:\n\n```\n# Add Maven to PATH\nexport PATH=\"/opt/tools/apache-maven-3.6.1/bin:${PATH}\"\n```\n\n### Check\n\n```\npi@raspberrypi:~/git/FHIR $ mvn -version\nApache Maven 3.6.1 (d66c9c0b3152b2e69ee9bac180bb8fcc8e6af555; 2019-04-04T15:00:29-04:00)\nMaven home: /opt/tools/apache-maven-3.6.1\nJava version: 11.0.3, vendor: Raspbian, runtime: /usr/lib/jvm/java-11-openjdk-armhf\nDefault locale: en_US, platform encoding: UTF-8\nOS name: \"linux\", version: \"4.19.66-v7l+\", arch: \"arm\", family: \"unix\"\n```\n\n\n\n## Environment\n\n| Component    | Details        |\n| ------------ | -------------- |\n| Liberty Home | /opt/ibm/fhir-server/wlp |\n| JAVA_HOME    | /usr/lib/jvm/java-11-openjdk-armhf |\n\n## Building\n\nSet up your development environment and clone the repository: \n\n```\nmkdir -p ~/git && cd ~/git && git clone https://github.com/IBM/FHIR.git\n```\n\nNow you should be ready to build:\n\n```\ncd ~/git/FHIR\nmvn clean install -f fhir-parent/pom.xml\n```\n\nBe patient. A lot of unit tests are executed, including processing a number of the FHIR specification examples in various contexts which is fairly CPU intensive. Unit tests in the fhir-persistence-jdbc project use a functional schema deployed in a Derby database, exercising the bulk of the persistence code except for the REST layer.\n\nSome exceptions from negative tests may appear in the build log. As long as the build completes, these shouldn't be a concern. Success should look like this:\n\n```\n[INFO] Reactor Summary for IBM FHIR Server FHIR 4.0.0-SNAPSHOT:\n[INFO] \n[INFO] IBM FHIR Server ...................... SUCCESS [  8.537 s]\n[INFO] fhir-core .......................................... SUCCESS [  7.478 s]\n[INFO] fhir-task-api ...................................... SUCCESS [  0.583 s]\n[INFO] fhir-task-core ..................................... SUCCESS [  9.217 s]\n[INFO] fhir-database-utils ................................ SUCCESS [ 16.877 s]\n[INFO] fhir-config ........................................ SUCCESS [ 12.278 s]\n[INFO] fhir-audit ......................................... SUCCESS [ 13.421 s]\n[INFO] fhir-model ......................................... SUCCESS [03:32 min]\n[INFO] fhir-conformance ................................... SUCCESS [ 39.934 s]\n[INFO] fhir-ig-us-core .................................... SUCCESS [ 23.337 s]\n[INFO] fhir-search ........................................ SUCCESS [01:16 min]\n[INFO] fhir-persistence ................................... SUCCESS [ 38.613 s]\n[INFO] fhir-replication-api ............................... SUCCESS [ 11.191 s]\n[INFO] fhir-persistence-proxy ............................. SUCCESS [ 28.315 s]\n[INFO] fhir-persistence-schema ............................ SUCCESS [04:44 min]\n[INFO] fhir-persistence-jdbc .............................. SUCCESS [16:34 min]\n[INFO] fhir-provider ...................................... SUCCESS [  9.223 s]\n[INFO] fhir-operation ..................................... SUCCESS [ 26.337 s]\n[INFO] fhir-operation-validate ............................ SUCCESS [  1.065 s]\n[INFO] fhir-operation-document ............................ SUCCESS [  1.074 s]\n[INFO] fhir-operation-healthcheck ......................... SUCCESS [  0.547 s]\n[INFO] fhir-client ........................................ SUCCESS [ 12.460 s]\n[INFO] fhir-cli ........................................... SUCCESS [ 12.682 s]\n[INFO] fhir-notification .................................. SUCCESS [  0.971 s]\n[INFO] fhir-notification-kafka ............................ SUCCESS [  0.769 s]\n[INFO] fhir-notification-websocket ........................ SUCCESS [  0.931 s]\n[INFO] FHIR Server REST API Implementation ................ SUCCESS [ 36.295 s]\n[INFO] FHIR Server REST API WebApp ........................ SUCCESS [ 11.151 s]\n[INFO] fhir-server-test ................................... SUCCESS [  6.484 s]\n[INFO] fhir-swagger-generator ............................. SUCCESS [  5.121 s]\n[INFO] fhir-openapi ....................................... SUCCESS [  0.739 s]\n[INFO] fhir-install ....................................... SUCCESS [ 59.261 s]\n[INFO] fhir-coverage-reports .............................. SUCCESS [ 43.491 s]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  33:28 min\n[INFO] Finished at: 2019-09-11T19:23:06-04:00\n[INFO] ------------------------------------------------------------------------\n```\n\n\n## Installation\n\nThe above build creates an installable artifact:\n\n```\n~/git/FHIR/fhir-install/target/fhir-server-distribution.zip\n```\n\nUnpack the archive into a working directory:\n\n```\nmkdir -p ~/unpack && cd ~/unpack && unzip ~/git/FHIR/fhir-install/target/fhir-server-distribution.zip\n```\n\nDecide where you want to install. As this isn't a production server, installing it under the pi user is convenient.\n\nmkdir -p ~/runtime/fhir-server && sh ~/unpack/fhir-server-dist/install.sh ~/runtime/fhir-server \n\n\nCheck that the Liberty runtime was installed correctly:\n\n```\n~/runtime/fhir-server/wlp/bin/server status fhir-server\n\nServer fhir-server is not running.\n```\n\nThe default configuration uses a 4GB heap size which is too large for the Pi. Edit the jvm.options file and reduce the memory footprint using -Xmx1024M and -Xms1024M:\n\n```\npi@raspberrypi:~ $ vi ~/runtime/fhir-server/wlp/usr/servers/fhir-server/jvm.options \n...\ngrep -- -Xm ~/runtime/fhir-server/wlp/usr/servers/fhir-server/jvm.options\n-Xms1024M\n-Xmx1024M\n\n```\n\nStart the server (the first startup takes some time):\n\n\n```\n~/runtime/fhir-server/wlp/bin/server start fhir-server\n\nStarting server fhir-server.\nServer fhir-server started with process ID 1234.\n```\n\n\n\n## Smoke Test\n\nRun a basic connectivity check. This is a primitive check to ensure that the application server is accessible and that the FHIR web application is running:\n\n```\nsh ~/unpack/fhir-server-dist/fhirSmokeTest.sh localhost 9443\n\nChecking if server localhost is accessible on port 9443 ... OK!\nChecking FHIR server signature... OK!\nChecking FHIR API version... OK!\n\nSuccess! All checks passed.\n```\n\n\n## Clean up\n\n```\nrm -fr ~/unpack/fhir-server-dist\nrm -f /tmp/apache-maven-3.6.1-bin.tar.gz\n```\n\n\n\n## Create a Patient Resource\n\nCreate a new patient resource using the following POST. The FHIR server will allocate a unique logical identifier (UUID):\n\n```\ncurl -k \\\n-H 'Content-Type: application/json' \\\n-u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient' -d '\n{\n    \"resourceType\" : \"Patient\",\n    \"active\" : true,\n    \"name\" : [ {\n        \"family\" : \"Ortiz\",\n        \"given\" : [ \"David\" ]\n    } ],\n    \"gender\" : \"male\"\n}\n'\n```\n\n\nThe FHIR server should respond with a 201 Created status:\n\n```\nHTTP/2 201 \nlocation: https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history/1\netag: W/\"1\"\nlast-modified: 2019-09-12T19:22:02.159503Z\ndate: Thu, 12 Sep 2019 19:22:05 GMT\ncontent-length: 0\ncontent-language: en-US\n```\n\nUse the `location:` value returned from **your** POST to read back the resource:\n\nCommand (example):\n\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc' | python -m json.tool\n```\n\n> Remember to use the patient logical id returned as the location: header in your POST - if you try to use `041786ad-d6a1-42ea-bf47-4dd8eb08a5fc` the response status will be Not Found.\n\nOutput:\n\n```\n{\n    \"active\": true,\n    \"gender\": \"male\",\n    \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n    \"meta\": {\n        \"lastUpdated\": \"2019-09-12T19:22:02.159503Z\",\n        \"versionId\": \"1\"\n    },\n    \"name\": [\n        {\n            \"family\": \"Ortiz\",\n            \"given\": [\n                \"David\"\n            ]\n        }\n    ],\n    \"resourceType\": \"Patient\"\n}\n```\n\nNow we can update the resource using a PUT (David => Dave). Again, it is important to use the logical ids from your example, not the values shown here. This includes the \"id\" field in the body, which should match the logical id of the URL:\n\n```\ncurl -k -i \\\n-X PUT \\\n-H 'Content-Type: application/json' \\\n-u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc' -d '\n{\n    \"active\": true,\n    \"gender\": \"male\",\n    \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n    \"meta\": {\n        \"lastUpdated\": \"2019-09-12T19:22:02.159503Z\",\n        \"versionId\": \"1\"\n    },\n    \"name\": [\n        {\n            \"family\": \"Ortiz\",\n            \"given\": [\n                \"Dave\"\n            ]\n        }\n    ],\n    \"resourceType\": \"Patient\"\n}\n'\n```\n\nResponse:\n\n```\nHTTP/2 200 \nlocation: https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history/2\netag: W/\"2\"\nlast-modified: 2019-09-12T19:46:24.656131Z\ndate: Thu, 12 Sep 2019 19:46:26 GMT\ncontent-length: 0\ncontent-language: en-US\n```\n\nNote the location: has now changed to indicate the new version is 2.\n\nRetrieve the latest version:\n\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc' | python -m json.tool\n```\n\nResponse:\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc' | python -m json.tool\n{\n    \"active\": true,\n    \"gender\": \"male\",\n    \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n    \"meta\": {\n        \"lastUpdated\": \"2019-09-12T19:46:24.656131Z\",\n        \"versionId\": \"2\"\n    },\n    \"name\": [\n        {\n            \"family\": \"Ortiz\",\n            \"given\": [\n                \"Dave\"\n            ]\n        }\n    ],\n    \"resourceType\": \"Patient\"\n}\n\n```\n\nNote that the given name is \"Dave\".\n\nTo see a previous version, perform a vread:\n\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history/1' | python -m json.tool\n\n```\n\nResponse:\n\n```\n{\n    \"active\": true,\n    \"gender\": \"male\",\n    \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n    \"meta\": {\n        \"lastUpdated\": \"2019-09-12T19:22:02.159503Z\",\n        \"versionId\": \"1\"\n    },\n    \"name\": [\n        {\n            \"family\": \"Ortiz\",\n            \"given\": [\n                \"David\"\n            ]\n        }\n    ],\n    \"resourceType\": \"Patient\"\n}\n\n```\n\nIn version 1, we see that the given name is the original value of \"David\".\n\nAll the versions of the resource can be read using a history read operation:\n\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history' | python -m json.tool\n```\n\nThe response is a FHIR bundle resource containing both versions of the Patient. Note the name change from David (version 1) to Dave (version 2):\n\n```\n{\n    \"entry\": [\n        {\n            \"fullUrl\": \"https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n            \"request\": {\n                \"method\": \"PUT\",\n                \"url\": \"Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\"\n            },\n            \"resource\": {\n                \"active\": true,\n                \"gender\": \"male\",\n                \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n                \"meta\": {\n                    \"lastUpdated\": \"2019-09-12T19:46:24.656131Z\",\n                    \"versionId\": \"2\"\n                },\n                \"name\": [\n                    {\n                        \"family\": \"Ortiz\",\n                        \"given\": [\n                            \"Dave\"\n                        ]\n                    }\n                ],\n                \"resourceType\": \"Patient\"\n            },\n            \"response\": {\n                \"status\": \"200\"\n            }\n        },\n        {\n            \"fullUrl\": \"https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n            \"request\": {\n                \"method\": \"POST\",\n                \"url\": \"Patient\"\n            },\n            \"resource\": {\n                \"active\": true,\n                \"gender\": \"male\",\n                \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n                \"meta\": {\n                    \"lastUpdated\": \"2019-09-12T19:22:02.159503Z\",\n                    \"versionId\": \"1\"\n                },\n                \"name\": [\n                    {\n                        \"family\": \"Ortiz\",\n                        \"given\": [\n                            \"David\"\n                        ]\n                    }\n                ],\n                \"resourceType\": \"Patient\"\n            },\n            \"response\": {\n                \"status\": \"200\"\n            }\n        }\n    ],\n    \"id\": \"cecfa920-ead0-402a-9431-35b7e6c2a768\",\n    \"link\": [\n        {\n            \"relation\": \"self\",\n            \"url\": \"https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history\"\n        }\n    ],\n    \"resourceType\": \"Bundle\",\n    \"total\": 2,\n    \"type\": \"history\"\n}\n\n```\n\n### END-OF-DOCUMENT\n","type":"Mdx","contentDigest":"5b2316f6a0be127f3efdc5c3b9cb8629","counter":105,"owner":"gatsby-plugin-mdx","fieldOwners":{"slug":"gatsby-plugin-slug"}},"frontmatter":{"title":"IBM FHIR Server on the Raspberry Pi 4","layout":"post","description":"IBM FHIR Server on the Raspberry Pi 4","date":"2019-10-08 09:59:05 -0400"},"exports":{},"rawBody":"---\nlayout: post\ntitle:  IBM FHIR Server on the Raspberry Pi 4\ndescription: IBM FHIR Server on the Raspberry Pi 4\ndate:   2019-10-08 09:59:05 -0400\n---\n\n![IBM FHIR Server on Raspberry Pi 4](https://ibm.github.io/FHIR/images/piOnFhir30.jpg)\n\n## Usage\n\nThis installation is for curiosity only and should not be used with PHI, only synthetic test data. Production instances require additional hardening which is outside the scope of this guide. \n\nThe default password used throughout is `change-password` and this is configured as clear-text in the configuration files to make it even more obvious that it should be changed as part of any hardening. Refer to the [FHIRServerUsersGuide](https://ibm.github.io/FHIR/guides/FHIRServerUsersGuide) for more details.\n\n## Introduction\n\nThe IBM FHIR Server runs as a web application in the Open Liberty application server. By default persistence is provided with a Derby database, but it can also be configured to use IBM Db2 on Cloud. This example shall use the default Derby instance.\n\n| Component    | Details        |\n| ------------ | -------------- |\n| Hardware     | Raspberry Pi 4 |\n| Memory       | 4GB            |\n| OS           | Raspbian (Buster) |\n| Storage      | 64GB microSD   |\n| Java         | openjdk11      |\n| Apache Maven | 3.6.1          |\n| Application Server | Open Liberty 19.0.0.8 |\n| HTTPS Port | 9443 |\n| Default user | fhiruser |\n| Default password | change-password |\n\nSet up your Raspberry Pi 4 (4GB model) using Raspbian (https://www.raspberrypi.org/downloads/).\n\n> TIP: Under load, the Raspberry Pi 4 CPU throttles when it reaches a critical temperature, so a case with cooling is recommended. Without naming products, an aluminum case which acts as a heat sink could be a good choice. The CPU definitely throttles during the build using the official (plastic) Raspberry Pi 4 case.\n\n## Development Environment and Prerequisites\n\nTo build we need three things:\n  1. openjdk11 (already available)\n  2. Apache Maven\n  3. Access to the internet (for Maven dependencies)\n\n### Install Maven\n\nYou can use apt-get to install Apache Maven but if you want to avoid all the dependencies which come along with it, just grab the binary release and unpack it\n\nOPTION A:\n\n```\nsudo apt-get install maven\n```\n\nOPTION B:\n\n```\nwget https://www-us.apache.org/dist/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz -P /tmp\nsudo mkdir -p /opt/tools && cd /opt/tools && tar xzvf /tmp/apache-maven-3.6.1-bin.tar.gz\n\n```\n\nIf installing Maven manually, add it to your PATH:\n\n```\n# Add Maven to PATH\nexport PATH=\"/opt/tools/apache-maven-3.6.1/bin:${PATH}\"\n```\n\n### Check\n\n```\npi@raspberrypi:~/git/FHIR $ mvn -version\nApache Maven 3.6.1 (d66c9c0b3152b2e69ee9bac180bb8fcc8e6af555; 2019-04-04T15:00:29-04:00)\nMaven home: /opt/tools/apache-maven-3.6.1\nJava version: 11.0.3, vendor: Raspbian, runtime: /usr/lib/jvm/java-11-openjdk-armhf\nDefault locale: en_US, platform encoding: UTF-8\nOS name: \"linux\", version: \"4.19.66-v7l+\", arch: \"arm\", family: \"unix\"\n```\n\n\n\n## Environment\n\n| Component    | Details        |\n| ------------ | -------------- |\n| Liberty Home | /opt/ibm/fhir-server/wlp |\n| JAVA_HOME    | /usr/lib/jvm/java-11-openjdk-armhf |\n\n## Building\n\nSet up your development environment and clone the repository: \n\n```\nmkdir -p ~/git && cd ~/git && git clone https://github.com/IBM/FHIR.git\n```\n\nNow you should be ready to build:\n\n```\ncd ~/git/FHIR\nmvn clean install -f fhir-parent/pom.xml\n```\n\nBe patient. A lot of unit tests are executed, including processing a number of the FHIR specification examples in various contexts which is fairly CPU intensive. Unit tests in the fhir-persistence-jdbc project use a functional schema deployed in a Derby database, exercising the bulk of the persistence code except for the REST layer.\n\nSome exceptions from negative tests may appear in the build log. As long as the build completes, these shouldn't be a concern. Success should look like this:\n\n```\n[INFO] Reactor Summary for IBM FHIR Server FHIR 4.0.0-SNAPSHOT:\n[INFO] \n[INFO] IBM FHIR Server ...................... SUCCESS [  8.537 s]\n[INFO] fhir-core .......................................... SUCCESS [  7.478 s]\n[INFO] fhir-task-api ...................................... SUCCESS [  0.583 s]\n[INFO] fhir-task-core ..................................... SUCCESS [  9.217 s]\n[INFO] fhir-database-utils ................................ SUCCESS [ 16.877 s]\n[INFO] fhir-config ........................................ SUCCESS [ 12.278 s]\n[INFO] fhir-audit ......................................... SUCCESS [ 13.421 s]\n[INFO] fhir-model ......................................... SUCCESS [03:32 min]\n[INFO] fhir-conformance ................................... SUCCESS [ 39.934 s]\n[INFO] fhir-ig-us-core .................................... SUCCESS [ 23.337 s]\n[INFO] fhir-search ........................................ SUCCESS [01:16 min]\n[INFO] fhir-persistence ................................... SUCCESS [ 38.613 s]\n[INFO] fhir-replication-api ............................... SUCCESS [ 11.191 s]\n[INFO] fhir-persistence-proxy ............................. SUCCESS [ 28.315 s]\n[INFO] fhir-persistence-schema ............................ SUCCESS [04:44 min]\n[INFO] fhir-persistence-jdbc .............................. SUCCESS [16:34 min]\n[INFO] fhir-provider ...................................... SUCCESS [  9.223 s]\n[INFO] fhir-operation ..................................... SUCCESS [ 26.337 s]\n[INFO] fhir-operation-validate ............................ SUCCESS [  1.065 s]\n[INFO] fhir-operation-document ............................ SUCCESS [  1.074 s]\n[INFO] fhir-operation-healthcheck ......................... SUCCESS [  0.547 s]\n[INFO] fhir-client ........................................ SUCCESS [ 12.460 s]\n[INFO] fhir-cli ........................................... SUCCESS [ 12.682 s]\n[INFO] fhir-notification .................................. SUCCESS [  0.971 s]\n[INFO] fhir-notification-kafka ............................ SUCCESS [  0.769 s]\n[INFO] fhir-notification-websocket ........................ SUCCESS [  0.931 s]\n[INFO] FHIR Server REST API Implementation ................ SUCCESS [ 36.295 s]\n[INFO] FHIR Server REST API WebApp ........................ SUCCESS [ 11.151 s]\n[INFO] fhir-server-test ................................... SUCCESS [  6.484 s]\n[INFO] fhir-swagger-generator ............................. SUCCESS [  5.121 s]\n[INFO] fhir-openapi ....................................... SUCCESS [  0.739 s]\n[INFO] fhir-install ....................................... SUCCESS [ 59.261 s]\n[INFO] fhir-coverage-reports .............................. SUCCESS [ 43.491 s]\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  33:28 min\n[INFO] Finished at: 2019-09-11T19:23:06-04:00\n[INFO] ------------------------------------------------------------------------\n```\n\n\n## Installation\n\nThe above build creates an installable artifact:\n\n```\n~/git/FHIR/fhir-install/target/fhir-server-distribution.zip\n```\n\nUnpack the archive into a working directory:\n\n```\nmkdir -p ~/unpack && cd ~/unpack && unzip ~/git/FHIR/fhir-install/target/fhir-server-distribution.zip\n```\n\nDecide where you want to install. As this isn't a production server, installing it under the pi user is convenient.\n\nmkdir -p ~/runtime/fhir-server && sh ~/unpack/fhir-server-dist/install.sh ~/runtime/fhir-server \n\n\nCheck that the Liberty runtime was installed correctly:\n\n```\n~/runtime/fhir-server/wlp/bin/server status fhir-server\n\nServer fhir-server is not running.\n```\n\nThe default configuration uses a 4GB heap size which is too large for the Pi. Edit the jvm.options file and reduce the memory footprint using -Xmx1024M and -Xms1024M:\n\n```\npi@raspberrypi:~ $ vi ~/runtime/fhir-server/wlp/usr/servers/fhir-server/jvm.options \n...\ngrep -- -Xm ~/runtime/fhir-server/wlp/usr/servers/fhir-server/jvm.options\n-Xms1024M\n-Xmx1024M\n\n```\n\nStart the server (the first startup takes some time):\n\n\n```\n~/runtime/fhir-server/wlp/bin/server start fhir-server\n\nStarting server fhir-server.\nServer fhir-server started with process ID 1234.\n```\n\n\n\n## Smoke Test\n\nRun a basic connectivity check. This is a primitive check to ensure that the application server is accessible and that the FHIR web application is running:\n\n```\nsh ~/unpack/fhir-server-dist/fhirSmokeTest.sh localhost 9443\n\nChecking if server localhost is accessible on port 9443 ... OK!\nChecking FHIR server signature... OK!\nChecking FHIR API version... OK!\n\nSuccess! All checks passed.\n```\n\n\n## Clean up\n\n```\nrm -fr ~/unpack/fhir-server-dist\nrm -f /tmp/apache-maven-3.6.1-bin.tar.gz\n```\n\n\n\n## Create a Patient Resource\n\nCreate a new patient resource using the following POST. The FHIR server will allocate a unique logical identifier (UUID):\n\n```\ncurl -k \\\n-H 'Content-Type: application/json' \\\n-u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient' -d '\n{\n    \"resourceType\" : \"Patient\",\n    \"active\" : true,\n    \"name\" : [ {\n        \"family\" : \"Ortiz\",\n        \"given\" : [ \"David\" ]\n    } ],\n    \"gender\" : \"male\"\n}\n'\n```\n\n\nThe FHIR server should respond with a 201 Created status:\n\n```\nHTTP/2 201 \nlocation: https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history/1\netag: W/\"1\"\nlast-modified: 2019-09-12T19:22:02.159503Z\ndate: Thu, 12 Sep 2019 19:22:05 GMT\ncontent-length: 0\ncontent-language: en-US\n```\n\nUse the `location:` value returned from **your** POST to read back the resource:\n\nCommand (example):\n\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc' | python -m json.tool\n```\n\n> Remember to use the patient logical id returned as the location: header in your POST - if you try to use `041786ad-d6a1-42ea-bf47-4dd8eb08a5fc` the response status will be Not Found.\n\nOutput:\n\n```\n{\n    \"active\": true,\n    \"gender\": \"male\",\n    \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n    \"meta\": {\n        \"lastUpdated\": \"2019-09-12T19:22:02.159503Z\",\n        \"versionId\": \"1\"\n    },\n    \"name\": [\n        {\n            \"family\": \"Ortiz\",\n            \"given\": [\n                \"David\"\n            ]\n        }\n    ],\n    \"resourceType\": \"Patient\"\n}\n```\n\nNow we can update the resource using a PUT (David => Dave). Again, it is important to use the logical ids from your example, not the values shown here. This includes the \"id\" field in the body, which should match the logical id of the URL:\n\n```\ncurl -k -i \\\n-X PUT \\\n-H 'Content-Type: application/json' \\\n-u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc' -d '\n{\n    \"active\": true,\n    \"gender\": \"male\",\n    \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n    \"meta\": {\n        \"lastUpdated\": \"2019-09-12T19:22:02.159503Z\",\n        \"versionId\": \"1\"\n    },\n    \"name\": [\n        {\n            \"family\": \"Ortiz\",\n            \"given\": [\n                \"Dave\"\n            ]\n        }\n    ],\n    \"resourceType\": \"Patient\"\n}\n'\n```\n\nResponse:\n\n```\nHTTP/2 200 \nlocation: https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history/2\netag: W/\"2\"\nlast-modified: 2019-09-12T19:46:24.656131Z\ndate: Thu, 12 Sep 2019 19:46:26 GMT\ncontent-length: 0\ncontent-language: en-US\n```\n\nNote the location: has now changed to indicate the new version is 2.\n\nRetrieve the latest version:\n\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc' | python -m json.tool\n```\n\nResponse:\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc' | python -m json.tool\n{\n    \"active\": true,\n    \"gender\": \"male\",\n    \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n    \"meta\": {\n        \"lastUpdated\": \"2019-09-12T19:46:24.656131Z\",\n        \"versionId\": \"2\"\n    },\n    \"name\": [\n        {\n            \"family\": \"Ortiz\",\n            \"given\": [\n                \"Dave\"\n            ]\n        }\n    ],\n    \"resourceType\": \"Patient\"\n}\n\n```\n\nNote that the given name is \"Dave\".\n\nTo see a previous version, perform a vread:\n\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history/1' | python -m json.tool\n\n```\n\nResponse:\n\n```\n{\n    \"active\": true,\n    \"gender\": \"male\",\n    \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n    \"meta\": {\n        \"lastUpdated\": \"2019-09-12T19:22:02.159503Z\",\n        \"versionId\": \"1\"\n    },\n    \"name\": [\n        {\n            \"family\": \"Ortiz\",\n            \"given\": [\n                \"David\"\n            ]\n        }\n    ],\n    \"resourceType\": \"Patient\"\n}\n\n```\n\nIn version 1, we see that the given name is the original value of \"David\".\n\nAll the versions of the resource can be read using a history read operation:\n\n```\ncurl --silent -k -H 'Accept: application/json' -u 'fhiruser:change-password' 'https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history' | python -m json.tool\n```\n\nThe response is a FHIR bundle resource containing both versions of the Patient. Note the name change from David (version 1) to Dave (version 2):\n\n```\n{\n    \"entry\": [\n        {\n            \"fullUrl\": \"https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n            \"request\": {\n                \"method\": \"PUT\",\n                \"url\": \"Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\"\n            },\n            \"resource\": {\n                \"active\": true,\n                \"gender\": \"male\",\n                \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n                \"meta\": {\n                    \"lastUpdated\": \"2019-09-12T19:46:24.656131Z\",\n                    \"versionId\": \"2\"\n                },\n                \"name\": [\n                    {\n                        \"family\": \"Ortiz\",\n                        \"given\": [\n                            \"Dave\"\n                        ]\n                    }\n                ],\n                \"resourceType\": \"Patient\"\n            },\n            \"response\": {\n                \"status\": \"200\"\n            }\n        },\n        {\n            \"fullUrl\": \"https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n            \"request\": {\n                \"method\": \"POST\",\n                \"url\": \"Patient\"\n            },\n            \"resource\": {\n                \"active\": true,\n                \"gender\": \"male\",\n                \"id\": \"041786ad-d6a1-42ea-bf47-4dd8eb08a5fc\",\n                \"meta\": {\n                    \"lastUpdated\": \"2019-09-12T19:22:02.159503Z\",\n                    \"versionId\": \"1\"\n                },\n                \"name\": [\n                    {\n                        \"family\": \"Ortiz\",\n                        \"given\": [\n                            \"David\"\n                        ]\n                    }\n                ],\n                \"resourceType\": \"Patient\"\n            },\n            \"response\": {\n                \"status\": \"200\"\n            }\n        }\n    ],\n    \"id\": \"cecfa920-ead0-402a-9431-35b7e6c2a768\",\n    \"link\": [\n        {\n            \"relation\": \"self\",\n            \"url\": \"https://localhost:9443/fhir-server/api/v4/Patient/041786ad-d6a1-42ea-bf47-4dd8eb08a5fc/_history\"\n        }\n    ],\n    \"resourceType\": \"Bundle\",\n    \"total\": 2,\n    \"type\": \"history\"\n}\n\n```\n\n### END-OF-DOCUMENT\n","fileAbsolutePath":"/home/runner/work/FHIR/FHIR/fhir/docs/src/pages/blog/raspberrypi4howto.mdx","fields":{"slug":"/blog/raspberrypi4howto"}}}},"staticQueryHashes":["1364590287","2102389209","2102389209","227138135","227138135","2456312558","2746626797","2746626797","3018647132","3018647132","3906363820","3906363820","768070550"]}